pipeline{
 agent{
  node{
  label "agent"
  }
 }
 parameters {
        string(name: 'PERSON', defaultValue: 'Mr Chakradhar', description: 'Who should I say hello to?')
        booleanParam(name: 'Deploy', defaultValue: false, description: 'Toggle this value')
 }
 environment{
 course = "jenkins"
 apiVersion = ""
 }
 options{
  disableConcurrentBuilds()
 }
 stages{
    stage('Read json file'){
    steps{
     script{
     def packagejson = readJSON file: "package.json"
     apiVersion = packagejson.version
     echo "apiversion: ${apiVersion}"
     }
    }
  }
  stage('Build catalogue image'){
    steps{
    sh"""
    docker build -t chakradhar05/catalogue:${apiVersion} .
    docker images
    """
    }
  }
  stage('Test'){
    environment{
    name = "chakras testing"
    }
    steps{
    echo "Testing"
    echo "${name}"
    }
  }
  stage('Deploy'){
    when{
    expression { params.Deploy == "true" }
    }
    steps{
    echo "Deploying"
    }
  }
 }
 post{
  always{
   cleanWs()
   echo "Always say hi"
  }
  success{
  echo "Passed the deployment"
  }
  failure{
  echo "Deployment failed"
  }
  aborted{
  echo "deployment aborted"
  }
 }
}
